Description: "Create an FSx for ONTAP volume with autosize parameters so they can be 'updated' later."

Parameters:
  FileSystemId:
    Description: "The File System ID."
    Type: String

  SecretArn:
    Description: "The Secret ARN that holds the fsxadmin password."
    Type: String

  SecretKey:
    Description: "The key to use within the AWS secret that holds the fsxadmin password."
    Default: "password"
    Type: String

  LinkArn:
    Description: "The ARN to the Lambda link function."
    Type: String

  SvmName:
    Description: "The SVM Name."
    Type: String

  VolumeName:
    Description: "The Volume Name."
    Type: String

  Size:
    Description: "The size of the volume in bytes."
    Default: 20971520
    Type: Number

  Aggregates:
    Description: "The aggregates to use."
    Type: CommaDelimitedList

  AutoSizeMode:
    Description: "The mode of the auto size. The supported values are 'grow', 'grown_shrink' or 'off'."
    Default: "off"
    Type: String

  MinimumShrinkSize:
    Description: "The minimum size the volume can shrink to in bytes."
    Default: 20971520
    Type: Number

  MaximumGrowSize:
    Description: "The maximum size of the volume can grow to in bytes."
    Default: 107374182400
    Type: Number

  GrowThresholdPercentage:
    Description: "The percentage of the volume size at which the volume is considered full."
    Default: 80
    Type: Number

  ShrinkThresholdPercentage:
    Description: "The percentage of the volume size at which the volume is considered empty."
    Default: 50
    Type: Number

Resources:
  FSxNVolume:
    Type: "NetApp::FSxN::Volume"

    Properties:
      FsxAdminPasswordSource:
        Secret:
          SecretArn: !Ref SecretArn
          SecretKey: !Ref SecretKey
      FileSystemId: !Ref FileSystemId
      LinkArn: !Ref LinkArn
      SVM:
        Name: !Ref SvmName
      Name: !Ref VolumeName

      Size: !Ref Size
      Aggregates: !Ref Aggregates

      Autosize:
        Mode: !Ref AutoSizeMode
        Minimum: !Ref MinimumShrinkSize
        Maximum: !Ref MaximumGrowSize
        GrowThreshold: !Ref GrowThresholdPercentage
        ShrinkThreshold: !Ref ShrinkThresholdPercentage
